<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisador de Férias Profissional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .animated-gradient-background {
            background: linear-gradient(-45deg, #111827, #1f2937, #374151);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #resultModal { transition: opacity 0.3s ease-in-out; }
        #modalContainer { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4 animated-gradient-background">
    <div class="w-full max-w-2xl mx-auto">
        <div class="bg-gray-900/50 backdrop-blur-xl border border-gray-700/50 rounded-2xl shadow-2xl p-6 sm:p-8 space-y-8">
            <div class="text-center">
                <div class="flex justify-center items-center mb-4">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Bras%C3%A3o_do_Par%C3%A1.svg/250px-Bras%C3%A3o_do_Par%C3%A1.svg.png" alt="Brasão do Pará" class="logo" style="width: 70px; height: 70px;">
                </div>
                <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500 mb-2">Analisador de Férias</h1>
                <p class="text-gray-400">Insira as informações para uma análise rápida e precisa.</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="codigoFuncionario" class="block mb-2 text-sm font-medium text-gray-300">Código do Funcionário:</label>
                    <input type="text" id="codigoFuncionario" placeholder="Ex: 1001" required class="bg-gray-700/50 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 transition">
                </div>
                <div>
                    <label for="inicioAquisitivo" class="block mb-2 text-sm font-medium text-gray-300">Início do Período Aquisitivo:</label>
                    <input type="date" id="inicioAquisitivo" required class="bg-gray-700/50 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 transition">
                </div>
                <div>
                    <label for="inicioFerias" class="block mb-2 text-sm font-medium text-gray-300">Data de Início das Férias:</label>
                    <input type="date" id="inicioFerias" required class="bg-gray-700/50 border border-gray-600 text-gray-200 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5 transition">
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
                <button id="verificarBtn" class="w-full flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 shadow-lg shadow-indigo-900/50 focus:outline-none focus:ring-4 focus:ring-indigo-500/50 transform hover:-translate-y-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                    Verificar
                </button>
                <button id="limparBtn" class="w-full flex items-center justify-center gap-2 bg-gray-700 hover:bg-rose-600 text-white font-bold py-3 px-4 rounded-lg transition-all duration-300 shadow-lg focus:outline-none focus:ring-4 focus:ring-rose-500/50 transform hover:-translate-y-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                    Limpar
                </button>
            </div>
        </div>
        <footer class="text-center mt-8">
            <p class="text-sm text-gray-600">© Criado por ISAAC.J.S.B | Desenvolvido por GIULIANO.L.A.F & HENRIQUE.B</p>
        </footer>
    </div>

    <div id="resultModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div id="modalContainer" class="bg-gray-900 border border-gray-700/50 rounded-2xl shadow-2xl w-full max-w-md transform scale-95 max-h-[90vh] overflow-y-auto relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition z-10">
                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div id="modalDynamicContent"></div>
        </div>
    </div>
    
    <script>
        const funcionariosDb = [];
        let codigosAutomaticos = [];

        const loadFuncionarioData = (data) => {
            funcionariosDb.length = 0;
            funcionariosDb.push(...data);
            codigosAutomaticos = funcionariosDb
                .filter(func => func['RECEBE AUTOMÁTICO ?'] === 'SIM')
                .map(func => String(func['CÓDIGO']));
            console.log("Dados de funcionários carregados:", funcionariosDb.length, "registros.");
        };

        const parseDateAsUTC = (dateString) => {
            if (!dateString) return null;
            const [year, month, day] = dateString.split('-').map(Number);
            return new Date(Date.UTC(year, month - 1, day));
        };

        const buscarFuncionario = (codigo) => {
            const codigoStr = String(codigo).trim();
            return funcionariosDb.find(func => String(func['CÓDIGO']).trim() === codigoStr);
        };

        const calcularFerias = (dataInicio, dataSolicitacao, funcionario) => {
            const codigo = String(funcionario['CÓDIGO']);
            const cargo = String(funcionario['CARGO'] || '').toUpperCase();
            const categoria = String(funcionario['CATEGORIA'] || '').toUpperCase();

            const isMagisterio = cargo.includes("PROFESSOR") || cargo.includes("PROF") || cargo.includes("ESPECIALISTA") || categoria.includes("MAGISTERIO");

            if (cargo.includes("AGUARD APOSENT")) {
                return { availableVacationDays: 0, direitoAdquirido: false, dataFinalPeriodo: null, isAutomatic: false, isAGA: true, isMagisterio };
            }

            if (codigosAutomaticos.includes(codigo)) {
                const days = isMagisterio ? 45 : 30;
                return { availableVacationDays: days, direitoAdquirido: true, dataFinalPeriodo: null, isAutomatic: true, isMagisterio: isMagisterio };
            }

            let monthsPassed = (dataSolicitacao.getUTCFullYear() - dataInicio.getUTCFullYear()) * 12;
            monthsPassed -= dataInicio.getUTCMonth();
            monthsPassed += dataSolicitacao.getUTCMonth();
            if (dataSolicitacao.getUTCDate() < dataInicio.getUTCDate()) {
                monthsPassed--;
            }
            monthsPassed = Math.max(0, monthsPassed);

            const daysPerMonth = isMagisterio ? 3.75 : 2.5;
            const maxDays = isMagisterio ? 45 : 30;
            const availableVacationDays = Math.min(Math.floor(monthsPassed * daysPerMonth), maxDays);

            const fimPeriodo = new Date(dataInicio);
            fimPeriodo.setUTCFullYear(fimPeriodo.getUTCFullYear() + 1);
            const direitoAdquirido = dataSolicitacao >= fimPeriodo;

            return { availableVacationDays, direitoAdquirido, dataFinalPeriodo: fimPeriodo, isAutomatic: false, isMagisterio };
        };

        const modal = document.getElementById("resultModal");
        const modalContainer = document.getElementById("modalContainer");
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalDynamicContent = document.getElementById('modalDynamicContent');
        const codigoInput = document.getElementById("codigoFuncionario");
        const inicioAquisitivoInput = document.getElementById("inicioAquisitivo");
        const inicioFeriasInput = document.getElementById("inicioFerias");
        const verificarBtn = document.getElementById("verificarBtn");
        const limparBtn = document.getElementById("limparBtn");

        const showModal = () => {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContainer.classList.remove('scale-95');
            }, 10);
        };
        const hideModal = () => {
            modal.classList.add('opacity-0');
            modalContainer.classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };
        const limparCampos = () => {
            codigoInput.value = "";
            inicioAquisitivoInput.value = "";
            inicioFeriasInput.value = "";
            hideModal();
        };

        const obterDadosDoForm = () => {
            const codigo = codigoInput.value.trim();
            const inicioPeriodoStr = inicioAquisitivoInput.value;
            const inicioFeriasStr = inicioFeriasInput.value;
            if (!codigo || !inicioPeriodoStr || !inicioFeriasStr) {
                atualizarInterface(null, null, "Por favor, preencha todos os campos."); return null;
            }
            const dataInicio = parseDateAsUTC(inicioPeriodoStr);
            const dataSolicitacao = parseDateAsUTC(inicioFeriasStr);
            if (!dataInicio || !dataSolicitacao) {
                atualizarInterface(null, null, "Uma das datas inseridas é inválida."); return null;
            }
            if (dataSolicitacao < dataInicio) {
                atualizarInterface(null, null, "A data de início das férias não pode ser anterior ao período aquisitivo."); return null;
            }
            return { codigo, dataInicio, dataSolicitacao };
        };

        const atualizarInterface = (funcionario, resultadoCalculo, errorMessage = null) => {
            let contentHTML = '';
            if (errorMessage) {
                contentHTML = `<div class="p-8 text-center"><h3 class="text-2xl font-bold text-yellow-400 mb-2">Atenção</h3><p class="text-gray-300">${errorMessage}</p></div>`;
            } else {
                const isSuccess = resultadoCalculo.direitoAdquirido || resultadoCalculo.isAutomatic;
                const statusClass = isSuccess ? 'text-green-400' : 'text-rose-400';
                let statusMessage, detailsHTML = '';

                const infoFuncionarioHTML = `
                    <div class="text-left border-t border-b border-gray-700 my-4 py-4 px-2 space-y-2">
                        <p class="text-sm"><strong class="text-gray-400 font-medium">CÓDIGO:</strong> ${(funcionario) ? funcionario['CÓDIGO'] : 'N/A'}</p>
                        <p class="text-sm"><strong class="text-gray-400 font-medium">CARGO:</strong> ${(funcionario) ? funcionario['CARGO'] : 'N/A'}</p>
                        <p class="text-sm"><strong class="text-gray-400 font-medium">CATEGORIA:</strong> ${(funcionario) ? funcionario['CATEGORIA'] : 'N/A'}</p>
                    </div>
                `;

                if (resultadoCalculo.isAutomatic) {
                    statusMessage = 'Direito Automático!';
                    detailsHTML = `<p class="text-lg font-bold">Dias de férias disponíveis: ${resultadoCalculo.availableVacationDays}</p>`;
                } else if (resultadoCalculo.isAGA) {
                    statusMessage = 'NÃO TEM DIREITO (AGA)';
                    detailsHTML = `<p class="text-lg font-bold">Dias de férias disponíveis: 0</p>`;
                } else {
                    const dataFinalFormatada = resultadoCalculo.dataFinalPeriodo.toLocaleDateString('pt-BR', { timeZone: 'UTC' });
                    statusMessage = isSuccess ? 'Direito Adquirido!' : 'Direito Não Adquirido';
                    detailsHTML = `<p class="text-lg font-bold">Dias de férias disponíveis: ${resultadoCalculo.availableVacationDays}</p>
                                   <p class="mt-2 text-gray-400">Fim do período aquisitivo: ${dataFinalFormatada}</p>`;
                }

                if (resultadoCalculo.isMagisterio) {
                    detailsHTML += `<p class="text-xs text-indigo-400 mt-2">(Benefício de 45 dias aplicado - Magistério)</p>`;
                }

                contentHTML = `<div class="p-6 text-center">
                                    <h3 class="text-2xl font-bold mb-2 ${statusClass}">${statusMessage}</h3>
                                    <div class="space-y-2 text-gray-300">${detailsHTML}</div>
                                    ${infoFuncionarioHTML}
                               </div>`;
            }
            modalDynamicContent.innerHTML = contentHTML;
            showModal();
        };

        verificarBtn.addEventListener('click', () => {
            const dados = obterDadosDoForm();
            if (!dados) return;
            const funcionario = buscarFuncionario(dados.codigo);
            if (!funcionario) {
                atualizarInterface(null, null, "Funcionário não encontrado. Verifique o código digitado."); return;
            }
            const resultadoCalculo = calcularFerias(dados.dataInicio, dados.dataSolicitacao, funcionario);
            atualizarInterface(funcionario, resultadoCalculo);
        });
        limparBtn.addEventListener('click', limparCampos);
        closeModalBtn.addEventListener('click', hideModal);

        // --- CÓDIGO MODIFICADO ---
        // Este bloco agora busca o arquivo COD.json quando a página carrega
        document.addEventListener('DOMContentLoaded', () => {
            fetch('COD.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro na rede ao buscar o arquivo JSON.');
                    }
                    return response.json();
                })
                .then(data => {
                    loadFuncionarioData(data);
                })
                .catch(e => {
                    console.error("Erro ao carregar dados do arquivo COD.json:", e);
                    atualizarInterface(null, null, "Ocorreu um erro crítico ao carregar a base de dados.");
                });
        });
    </script>
</body>
</html>